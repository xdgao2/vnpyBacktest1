<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CTA Backtest Report</title>
    <script src="data.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* (原有 CSS 保持不变) */
        .stats-group-title { background: #f8f9fa; padding: 8px 15px; font-weight: bold; border-left: 4px solid #3498db; margin: 20px 0 10px 0; grid-column: 1 / -1; }
    </style>
</head>
<body>
    <script>
        // 核心逻辑：从 window.backtestData 直接读取
        const rawData = window.backtestData;
        
        // 补全所有统计项配置
        const statsConfig = [
            { title: "收益表现", items: [
                { key: "total_return", label: "总收益率", unit: "%" },
                { key: "annual_return", label: "年化收益", unit: "%" },
                { key: "total_pnl", label: "总盈亏", unit: "¥" },
                { key: "end_balance", label: "结束资金", unit: "¥" },
                { key: "daily_return", label: "日均收益率", unit: "%" }
            ]},
            { title: "风险与稳定性", items: [
                { key: "max_drawdown", label: "最大回撤金额", unit: "¥" },
                { key: "max_ddpercent", label: "百分比最大回撤", unit: "%" },
                { key: "max_drawdown_duration", label: "最大回撤天数", unit: "天" },
                { key: "sharpe_ratio", label: "Sharpe Ratio", unit: "" },
                { key: "daily_return_std", label: "收益标准差", unit: "%" },
                { key: "return_drawdown_ratio", label: "收益回撤比", unit: "" }
            ]},
            { title: "交易细节", items: [
                { key: "total_trade_count", label: "总成交笔数", unit: "笔" },
                { key: "winning_rate", label: "胜率", unit: "%" },
                { key: "profit_loss_ratio", label: "盈亏比", unit: "" },
                { key: "total_commission", label: "总手续费", unit: "¥" },
                { key: "total_slippage", label: "总滑点", unit: "¥" }
            ]}
        ];

        function initReport() {
            if (!rawData) return;
            
            // 设置标题信息
            document.getElementById('header-symbol').innerText = rawData.metadata.symbol;
            document.getElementById('header-strategy').innerText = rawData.metadata.strategy;
            
            // 渲染统计网格
            renderStats(rawData.stats);
            // 渲染图表
            renderCharts(rawData.daily_data);
        }

        function renderStats(stats) {
            const container = document.getElementById('stats-grid');
            let html = '';
            statsConfig.forEach(group => {
                html += `<div class="stats-group-title">${group.title}</div>`;
                group.items.forEach(item => {
                    let val = stats[item.key] ?? 'N/A';
                    let display = typeof val === 'number' ? val.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) : val;
                    html += `
                        <div class="stat-card">
                            <div class="stat-label">${item.label}</div>
                            <div class="stat-value">${display}<span class="stat-unit">${item.unit}</span></div>
                        </div>`;
                });
            });
            container.innerHTML = html;
        }

        // (其他图表渲染函数 renderCharts 逻辑类似，直接使用 rawData.daily_data 即可)
        window.onload = initReport;
    </script>
</body>
</html>